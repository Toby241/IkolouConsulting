<!DOCTYPE html>
<html lang="fr" class="overscroll-none">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ikolou Consulting | Assistant Devis</title>
    
    <!-- Fonts: Plus Jakarta Sans -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Google Material Symbols -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,1,0" />
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20width='128'%20height='128'%20viewBox='0%200%20128%20128'%3E%3Crect%20x='4'%20y='4'%20width='120'%20height='120'%20rx='20'%20fill='%230115d6'/%3E%3Cpath%20d='M42%2074%20C34%2074%2028%2068%2028%2060%20C28%2052%2034%2046%2042%2046%20C44%2036%2054%2030%2064%2030%20C76%2030%2086%2038%2088%2050%20C98%2050%20106%2058%20106%2068%20C106%2078%2098%2086%2088%2086%20H44%20C36%2086%2030%2080%2030%2072'%20fill='white'/%3E%3C/svg%3E">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    
    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Plus Jakarta Sans"', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            blue: '#0115d6', 
                            dark: '#0F172A',
                            lime: '#CCFF00',
                            gray: '#64748B',
                            light: '#F8FAFC'
                        }
                    },
                    boxShadow: {
                        'float': '0 10px 40px -10px rgba(1, 21, 214, 0.15)',
                        'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.07)'
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #F8FAFC;
            color: #0F172A;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .typing-dot {
            width: 6px; height: 6px;
            background: #0115d6;
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        .glass-morphism {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(226, 232, 240, 0.6);
        }

        .message-entry { will-change: transform, opacity; }

        textarea {
            resize: none;
            overflow: hidden;
            min-height: 24px;
            max-height: 120px;
        }

        /* Selection styles for multi-select cards */
        .card-selected {
            border-color: #0115d6 !important;
            background-color: #eff6ff !important; /* blue-50 */
        }
        .card-selected .icon-box {
            background-color: #0115d6 !important;
            color: white !important;
        }
    </style>
</head>
<body class="h-[100dvh] flex flex-col overflow-hidden overscroll-none relative bg-slate-50">

    <!-- Header -->
    <header class="absolute top-0 w-full glass-morphism p-4 z-20 shadow-sm">
        <div class="max-w-3xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer group" onclick="resetChat()">
                <div class="w-10 h-10 bg-[#0115d6] rounded-xl flex items-center justify-center text-white shadow-lg shadow-blue-900/20 group-hover:scale-105 transition-transform duration-300">
                    <span class="material-symbols-rounded text-2xl">headset_mic</span>
                </div>
                <div class="flex flex-col">
                    <span class="font-extrabold tracking-tight text-lg leading-none text-brand-dark">Ikolou<span class="text-[#0115d6]">.</span></span>
                    <span class="text-[10px] text-slate-400 font-bold uppercase tracking-widest mt-0.5">Consulting</span>
                </div>
            </div>
            
            <div class="flex items-center gap-4">
                <div class="hidden md:block w-32 h-1.5 bg-slate-200 rounded-full overflow-hidden">
                    <div id="progress-bar" class="h-full bg-[#0115d6] w-0 transition-all duration-500 ease-out rounded-full"></div>
                </div>
                <button onclick="resetChat()" class="p-2 rounded-full hover:bg-slate-100 text-slate-400 hover:text-[#0115d6] transition-all">
                    <i data-lucide="rotate-ccw" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
        <div class="absolute bottom-0 left-0 w-full h-1 bg-slate-200 md:hidden">
            <div id="progress-bar-mobile" class="h-full bg-[#0115d6] w-0 transition-all duration-500 ease-out"></div>
        </div>
    </header>

    <!-- Chat Area -->
    <main id="chat-container" class="flex-1 overflow-y-auto px-4 pt-28 pb-64 space-y-6 scroll-smooth z-10 w-full max-w-3xl mx-auto relative custom-scrollbar">
        <!-- Messages injected here -->
    </main>

    <!-- Input Area -->
    <div id="input-sheet" class="fixed bottom-0 left-0 right-0 z-30 pointer-events-auto bg-white rounded-t-[2rem] shadow-[0_-10px_40px_-15px_rgba(0,0,0,0.1)] transform translate-y-full transition-transform duration-500 ease-out border-t border-slate-100">
        <div class="w-full max-w-3xl mx-auto px-4 pt-2 pb-6 relative">
            <!-- Handle -->
            <div class="mx-auto w-12 h-1 bg-slate-200 rounded-full mb-3 mt-2"></div>

            <!-- Chips -->
            <div id="chips-container" class="flex gap-2 overflow-x-auto pb-2 mb-1 no-scrollbar min-h-[36px] opacity-0 transition-opacity"></div>

            <!-- Dynamic Input -->
            <div id="input-zone" class="min-h-[50px] flex items-end justify-center w-full transition-all relative"></div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="result-modal" class="fixed inset-0 z-50 hidden items-center justify-center p-4">
        <div id="result-backdrop" class="absolute inset-0 bg-brand-dark/80 backdrop-blur-sm opacity-0 transition-opacity duration-300"></div>
        <div id="result-content" class="relative bg-white w-full max-w-sm rounded-[2rem] shadow-2xl p-8 transform scale-90 opacity-0 transition-all duration-500 text-center">
            <div class="w-20 h-20 bg-[#0115d6]/10 rounded-full flex items-center justify-center mx-auto mb-6 animate-bounce">
                <i data-lucide="check" class="w-10 h-10 text-[#0115d6] stroke-[3]"></i>
            </div>
            <h2 class="text-2xl font-extrabold text-brand-dark tracking-tight mb-2">Merci <span id="client-name-display"></span> !</h2>
            <p class="text-slate-500 text-sm mb-8 leading-relaxed font-medium">Nous avons bien re√ßu vos informations. Nous vous recontacterons tr√®s rapidement.</p>
            <div class="space-y-3">
                <button onclick="generatePDF()" class="w-full bg-slate-50 hover:bg-slate-100 text-brand-dark font-bold py-3.5 rounded-xl flex items-center justify-center gap-2 transition-all border border-slate-200">
                    <i data-lucide="download" class="w-4 h-4"></i>
                    <span>T√©l√©charger le PDF</span>
                </button>
                <button onclick="contactSupport()" class="w-full bg-[#0115d6] hover:bg-blue-800 text-white font-bold py-4 rounded-xl flex items-center justify-center gap-2 transition-all shadow-lg shadow-blue-900/30 active:scale-95">
                    <span>Parler √† un expert maintenant</span>
                    <i data-lucide="message-circle" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        const WHATSAPP_NUMBER = "241074420356"; 
        const STORAGE_KEY = "ikolou_bot_v9_reordered";
        lucide.createIcons();

        let state = {
            step: -1,
            name: '',
            answers: {},
            multiBuffer: [] // For multi-select
        };

        const questions = [
            { 
                id: 'name', 
                type: 'text', 
                text: "Bonjour ! Je suis l'assistant Ikolou. Commen√ßons par les pr√©sentations. Quel est votre nom ?",
                placeholder: 'Votre Pr√©nom et Nom',
                suggestions: []
            },
            { 
                id: 'company', 
                type: 'text', 
                text: "Enchant√© ! Quel est le nom de votre entreprise ou organisation ?",
                placeholder: 'Nom de l\'entreprise',
                suggestions: []
            },
            { 
                id: 'sector', 
                type: 'select', 
                text: "Dans quel secteur d'activit√© √©voluez-vous ?", 
                options: [
                    { label: 'Commerce & Vente', desc: 'Retail, E-commerce, Boutique', icon: 'shopping-bag' },
                    { label: 'Services & Conseil', desc: 'Agence, Cabinet, Freelance', icon: 'briefcase' },
                    { label: 'Sant√© & M√©dical', desc: 'Clinique, Cabinet, Pharma', icon: 'activity' },
                    { label: '√âducation & Formation', desc: '√âcole, Centre de formation', icon: 'book' },
                    { label: 'Industrie & BTP', desc: 'Construction, Production', icon: 'hard-hat' },
                    { label: 'Autre', desc: 'Autre secteur ou non list√©', icon: 'layers' }
                ]
            },
            { 
                id: 'email', 
                type: 'text', 
                text: "Quelle est votre adresse email professionnelle pour vous envoyer le dossier ?",
                placeholder: 'nom@entreprise.com'
            },
            { 
                id: 'phone', 
                type: 'text', 
                text: "Un num√©ro de t√©l√©phone pour vous joindre ?",
                placeholder: '+241 00 00 00 00'
            },
            { 
                id: 'service', 
                type: 'select', 
                text: "De quoi avez-vous besoin sp√©cifiquement ?", 
                options: [
                    { label: "Gestion d'entreprise", desc: "Caisse, facturation, CRM, ERP...", icon: 'briefcase' },
                    { label: "Digitalisation formations", desc: "Plateforme LMS, cours en ligne...", icon: 'monitor' },
                    { label: "Formation", desc: "Programmes certifiants MS Office...", icon: 'graduation-cap' },
                    { label: "D√©veloppement Web", desc: "Site vitrine, institutionnel ou portail", icon: 'globe' },
                    { label: "D√©veloppement App", desc: "App mobile iOS / Android", icon: 'smartphone' },
                    { label: "H√©bergement Web", desc: "Solutions serveur s√©curis√©es", icon: 'server' }
                ]
            },
            { 
                id: 'features',
                type: 'multi', // New Multi-select type
                text: "Quelles fonctionnalit√©s cl√©s envisagez-vous ?",
                // These options show if service suggests tech needs. Generic enough for most.
                options: [
                    { label: "Espace Admin", icon: 'shield' },
                    { label: "Espace Membre", icon: 'users' },
                    { label: "Paiement en ligne", icon: 'credit-card' },
                    { label: "Formulaire de contact", icon: 'mail' },
                    { label: "R√©servation / RDV", icon: 'calendar' },
                    { label: "Catalogue Produits", icon: 'shopping-cart' },
                    { label: "Blog / Actus", icon: 'file-text' }
                ]
            },
            { 
                id: 'budget', 
                type: 'select', 
                text: "Avez-vous une id√©e du budget allou√© ?", 
                options: [
                    { label: 'Basique (~300k FCFA)', desc: "Fonctionnalit√©s essentielles", icon: 'credit-card' },
                    { label: 'Standard (~600k FCFA)', desc: "Rapport qualit√©/prix optimal", icon: 'layers' },
                    { label: 'Pro (~1M FCFA)', desc: "Solutions avanc√©es", icon: 'star' },
                    { label: 'Sur Mesure', desc: "Projet complexe", icon: 'zap' }
                ]
            },
            { 
                id: 'deadline', 
                type: 'select', 
                text: "Pour quand souhaitez-vous lancer ce projet ?", 
                options: [
                    { label: 'Tr√®s Urgent (< 2 semaines)', icon: 'alert-circle' },
                    { label: '1 mois', icon: 'calendar' },
                    { label: 'Dans le trimestre', icon: 'clock' }
                ]
            }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            gsap.to("#input-sheet", { y: 0, duration: 1, ease: "power4.out", delay: 0.2 });
            startChat();
        });

        function updateProgress() {
            const progress = ((state.step) / questions.length) * 100;
            document.getElementById('progress-bar').style.width = `${Math.min(progress, 100)}%`;
            document.getElementById('progress-bar-mobile').style.width = `${Math.min(progress, 100)}%`;
        }

        function startChat() {
            state.step = 0;
            state.answers = {};
            document.getElementById('chat-container').innerHTML = '';
            updateProgress();
            processStep();
        }

        function resetChat() {
            location.reload();
        }

        async function processStep() {
            if (state.step >= questions.length) {
                finishChat();
                return;
            }

            const q = questions[state.step];
            
            document.getElementById('chips-container').innerHTML = '';
            document.getElementById('input-zone').innerHTML = '';
            
            const delay = document.getElementById('chat-container').children.length > 0 ? 600 : 200;
            await showTyping(delay);

            addBotMessage(q.text);
            renderInput(q);
            updateProgress();
        }

        function renderInput(q) {
            const container = document.getElementById('input-zone');
            const chipsContainer = document.getElementById('chips-container');
            container.innerHTML = '';
            chipsContainer.innerHTML = '';
            chipsContainer.style.opacity = '0';

            if (q.type === 'text') {
                if (q.suggestions) {
                    q.suggestions.forEach(s => {
                        const chip = document.createElement('button');
                        chip.className = "whitespace-nowrap px-4 py-2 bg-white border border-slate-200 rounded-full text-xs font-semibold text-slate-600 hover:bg-[#0115d6] hover:text-white transition-colors duration-200 shadow-sm";
                        chip.innerText = s;
                        chip.onclick = () => { 
                            const input = document.getElementById('user-input');
                            input.value = s; 
                            autoResize(input);
                            submitText(); 
                        };
                        chipsContainer.appendChild(chip);
                    });
                    gsap.to(chipsContainer, { opacity: 1, duration: 0.3 });
                }

                container.innerHTML = `
                    <div class="w-full relative group opacity-0 transform translate-y-4" id="input-anim">
                        <form action="javascript:void(0);" onsubmit="submitText()" class="flex items-end bg-white border border-slate-200 rounded-[24px] p-2 w-full gap-2 focus-within:border-[#0115d6] focus-within:ring-2 focus-within:ring-blue-900/10 transition-all shadow-sm">
                            <textarea id="user-input" rows="1" class="flex-1 bg-transparent border-0 px-4 py-3 text-brand-dark text-base placeholder-slate-400 focus:ring-0 focus:outline-none max-h-32" placeholder="${q.placeholder || '√âcrivez ici...'}" autocomplete="off"></textarea>
                            <button type="submit" class="w-11 h-11 rounded-full flex-shrink-0 flex items-center justify-center bg-brand-dark text-white hover:bg-[#0115d6] transition-colors duration-300 shadow-md mb-0.5"><i data-lucide="arrow-up" class="w-5 h-5"></i></button>
                        </form>
                    </div>`;
                
                const textarea = document.getElementById('user-input');
                textarea.addEventListener('input', function() { autoResize(this); });
                textarea.addEventListener('keydown', function(e) { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); submitText(); } });
                setTimeout(() => textarea.focus(), 100);
            } 
            else if (q.type === 'select') {
                const btns = q.options.map(opt => {
                    const safeLabel = opt.label.replace(/'/g, "\\'");
                    return `
                    <button onclick="submitOption('${safeLabel}')" 
                    class="group relative bg-white border border-slate-200 hover:border-[#0115d6] hover:bg-slate-50 text-brand-dark p-4 rounded-xl text-left w-full min-w-[220px] max-w-[220px] snap-center flex-shrink-0 transition-all duration-300 shadow-sm hover:shadow-md active:scale-95 flex flex-col gap-3">
                        <div class="w-10 h-10 rounded-lg bg-[#0115d6]/10 flex items-center justify-center shrink-0 text-[#0115d6]"><i data-lucide="${opt.icon}" class="w-5 h-5"></i></div>
                        <div class="flex flex-col gap-1"><span class="font-bold text-sm leading-tight">${opt.label}</span>${opt.desc ? `<span class="text-[11px] text-slate-400 font-normal leading-tight line-clamp-2">${opt.desc}</span>` : ''}</div>
                    </button>`;
                }).join('');
                container.innerHTML = `<div class="flex gap-3 w-full opacity-0 transform translate-y-4 overflow-x-auto pb-4 px-1 snap-x no-scrollbar" id="input-anim">${btns}<div class="w-2 flex-shrink-0"></div></div>`;
            }
            else if (q.type === 'multi') {
                state.multiBuffer = []; // Reset buffer
                const btns = q.options.map(opt => {
                    const safeLabel = opt.label.replace(/'/g, "\\'");
                    return `
                    <button onclick="toggleMulti(this, '${safeLabel}')" 
                    class="multi-btn group relative bg-white border border-slate-200 text-brand-dark p-3 rounded-xl text-left w-full min-w-[140px] max-w-[140px] snap-center flex-shrink-0 transition-all duration-200 shadow-sm flex flex-col gap-2">
                        <div class="icon-box w-8 h-8 rounded-lg bg-slate-100 flex items-center justify-center shrink-0 text-slate-500 transition-colors"><i data-lucide="${opt.icon}" class="w-4 h-4"></i></div>
                        <span class="font-bold text-xs leading-tight">${opt.label}</span>
                    </button>`;
                }).join('');
                
                container.innerHTML = `
                    <div class="flex flex-col w-full gap-4 opacity-0 transform translate-y-4" id="input-anim">
                        <div class="flex gap-3 overflow-x-auto pb-2 px-1 snap-x no-scrollbar">${btns}<div class="w-2 flex-shrink-0"></div></div>
                        <button onclick="submitMulti()" class="w-full bg-brand-dark text-white font-bold py-3 rounded-xl shadow-lg hover:bg-[#0115d6] transition-colors flex items-center justify-center gap-2">
                            Confirmer la s√©lection <i data-lucide="check" class="w-4 h-4"></i>
                        </button>
                    </div>`;
            }
            
            gsap.to('#input-anim', { opacity: 1, y: 0, duration: 0.5, ease: "back.out(1.2)" });
            lucide.createIcons();
        }

        function autoResize(el) { el.style.height = 'auto'; el.style.height = el.scrollHeight + 'px'; }

        function submitText() {
            const val = document.getElementById('user-input').value.trim();
            if (!val) return;
            if (questions[state.step].id === 'email') {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!re.test(val)) {
                    gsap.to("#input-anim", { x: [-5, 5, -5, 5, 0], duration: 0.4 });
                    const name = state.answers['name'] || 'cher client';
                    addBotMessage(`Oups ${name}, cet e-mail semble invalide. Une petite v√©rification ?`);
                    return;
                }
            }
            addUserMessage(val);
            recordAnswer(val);
        }

        function submitOption(val) {
            addUserMessage(val);
            recordAnswer(val);
        }

        function toggleMulti(btn, val) {
            btn.classList.toggle('card-selected');
            const idx = state.multiBuffer.indexOf(val);
            if (idx > -1) state.multiBuffer.splice(idx, 1);
            else state.multiBuffer.push(val);
        }

        function submitMulti() {
            const val = state.multiBuffer.length > 0 ? state.multiBuffer.join(', ') : "Aucune fonctionnalit√© sp√©cifique";
            addUserMessage(val);
            recordAnswer(val);
        }

        function recordAnswer(val) {
            const qId = questions[state.step].id;
            state.answers[qId] = val;
            if (qId === 'name') state.name = val;
            state.step++;
            gsap.to('#input-anim', { opacity: 0, y: 10, duration: 0.2, onComplete: () => { processStep(); }});
            gsap.to('#chips-container', { opacity: 0, duration: 0.2 });
        }

        function addBotMessage(text) {
            const container = document.getElementById('chat-container');
            const div = document.createElement('div');
            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            div.innerHTML = `
                <div class="flex w-full mt-6 max-w-[90%] items-end opacity-0 transform translate-y-4 message-entry group">
                    <div class="flex flex-col gap-1">
                        <div class="bg-white p-4 rounded-2xl rounded-bl-none shadow-sm border border-slate-100 text-sm leading-relaxed text-brand-dark">
                            ${text}
                        </div>
                        <span class="text-[10px] text-slate-300 font-medium ml-1 opacity-0 group-hover:opacity-100 transition-opacity">${time}</span>
                    </div>
                </div>`;
            container.appendChild(div);
            gsap.to(div.querySelector('.message-entry'), { opacity: 1, y: 0, duration: 0.5, ease: "power2.out" });
            scrollToBottom();
        }

        function addUserMessage(text) {
            const container = document.getElementById('chat-container');
            const div = document.createElement('div');
            div.innerHTML = `
                <div class="flex w-full mt-6 justify-end opacity-0 transform translate-y-4 message-entry">
                    <div class="bg-brand-dark text-white p-3.5 px-5 rounded-[1.2rem] rounded-br-none shadow-lg shadow-brand-dark/10 text-sm leading-relaxed max-w-[85%]">
                        ${text.replace(/\n/g, '<br>')}
                    </div>
                </div>`;
            container.appendChild(div);
            gsap.to(div.querySelector('.message-entry'), { opacity: 1, y: 0, duration: 0.5, ease: "power2.out" });
            scrollToBottom();
        }

        function showTyping(duration) {
            return new Promise(resolve => {
                const container = document.getElementById('chat-container');
                const div = document.createElement('div');
                div.id = 'typing-indicator';
                div.innerHTML = `
                    <div class="flex w-full mt-6 items-end">
                        <div class="bg-slate-100/50 px-4 py-3 rounded-2xl rounded-bl-none flex items-center gap-1.5 h-10 w-fit">
                            <div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>
                        </div>
                    </div>`;
                container.appendChild(div);
                scrollToBottom();
                setTimeout(() => { gsap.to(div, { opacity: 0, height: 0, duration: 0.2, onComplete: () => { div.remove(); resolve(); }}); }, duration);
            });
        }

        function scrollToBottom() {
            const container = document.getElementById('chat-container');
            setTimeout(() => { container.scrollTo({ top: container.scrollHeight + 150, behavior: 'smooth' }); }, 50);
        }

        async function finishChat() {
            updateProgress();
            await showTyping(800);
            document.getElementById('client-name-display').innerText = state.answers['name'] || 'Client';
            gsap.to("#input-sheet", { y: "150%", duration: 0.6, ease: "power2.in" });
            const modal = document.getElementById('result-modal');
            const backdrop = document.getElementById('result-backdrop');
            const content = document.getElementById('result-content');
            modal.classList.remove('hidden'); modal.classList.add('flex');
            gsap.to(backdrop, { opacity: 1, duration: 0.4 });
            gsap.to(content, { opacity: 1, scale: 1, duration: 0.5, delay: 0.1, ease: "back.out(1.2)" });
        }

        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const pageWidth = doc.internal.pageSize.getWidth();
            const margin = 20;
            let y = 30;

            doc.setFont("helvetica", "bold"); doc.setFontSize(22); doc.setTextColor(1, 21, 214);
            doc.text("Devis Estimatif - Ikolou", margin, y);
            y += 10;
            doc.setFont("helvetica", "normal"); doc.setFontSize(10); doc.setTextColor(100, 100, 100);
            doc.text("Transformation Digitale & Formation", margin, y);
            y += 15; doc.setDrawColor(230, 230, 230); doc.line(margin, y, pageWidth - margin, y);

            y += 20; doc.setFont("helvetica", "bold"); doc.setFontSize(12); doc.setTextColor(0, 0, 0);
            doc.text("Client : " + (state.answers['company'] || '') + " - " + (state.answers['name'] || '-'), margin, y);
            doc.setFont("helvetica", "normal"); doc.setFontSize(10);
            doc.text("Email : " + (state.answers['email'] || '-'), margin, y + 6);
            doc.text("Tel : " + (state.answers['phone'] || '-'), margin, y + 12);
            doc.text("Secteur : " + (state.answers['sector'] || '-'), margin, y + 18);
            doc.text("Date : " + new Date().toLocaleDateString('fr-FR'), pageWidth - margin, y, { align: 'right' });

            y += 40; doc.setFontSize(14); doc.setFont("helvetica", "bold"); doc.setTextColor(15, 23, 42);
            doc.text("D√©tails du Projet", margin, y); y += 15;

            const items = [
                { l: "Service", v: state.answers['service'] },
                { l: "Fonctionnalit√©s", v: state.answers['features'] },
                { l: "Description", v: state.answers['details'] },
                { l: "Budget Envisag√©", v: state.answers['budget'] },
                { l: "D√©lai Souhait√©", v: state.answers['deadline'] }
            ];

            items.forEach(item => {
                if(!item.v) return;
                doc.setFontSize(9); doc.setFont("helvetica", "bold"); doc.setTextColor(150, 150, 150);
                doc.text(item.l.toUpperCase(), margin, y);
                y += 6; doc.setFontSize(11); doc.setFont("helvetica", "normal"); doc.setTextColor(0, 0, 0);
                const lines = doc.splitTextToSize(item.v, pageWidth - (margin * 2));
                doc.text(lines, margin, y);
                y += (lines.length * 6) + 10;
            });

            doc.setFontSize(8); doc.setTextColor(180, 180, 180);
            doc.text("Ikolou Consulting | Owendo, Gabon | +241 07 44 20 356", pageWidth / 2, 280, { align: 'center' });
            doc.save(`Devis_Ikolou_${(state.answers['name'] || 'Client').replace(/\s+/g, '_')}.pdf`);
        }

        function contactSupport() {
            const name = state.answers['name'] || "Client";
            const text = `Bonjour, je viens de faire un devis via votre plateforme Ikolou. J'attends votre retour avec impatience.`;
            window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(text)}`, '_blank');
        }

        function sendToWhatsApp() {
            let text = `üöÄ *DEMANDE DE DEVIS - IKOLOU*\n\n`;
            text += `üè¢ *Entreprise:* ${state.answers['company']}\n`;
            text += `üè¢ *Secteur:* ${state.answers['sector']}\n`;
            text += `üë§ *Nom:* ${state.answers['name']}\n`;
            text += `üìû *Tel:* ${state.answers['phone']}\n`;
            text += `üíª *Service:* ${state.answers['service']}\n`;
            text += `‚ö° *Fonctions:* ${state.answers['features'] || '-'}\n`;
            text += `üí∞ *Budget:* ${state.answers['budget']}\n`;
            text += `üìÖ *D√©lai:* ${state.answers['deadline']}\n\n`;
            text += `üìù *D√©tails:*\n${state.answers['details']}\n\n`;
            window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(text)}`, '_blank');
        }
    </script>
</body>
</html>